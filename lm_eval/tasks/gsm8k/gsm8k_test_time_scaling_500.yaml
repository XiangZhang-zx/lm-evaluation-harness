include: gsm8k.yaml  # 继承原始任务配置
task: gsm8k_test_time_scaling_500
repeats: 500  # 每个样本生成500次
generation_kwargs:
  until:
    - "Question:"
    - "</s>"
    - "<|im_end|>"
  do_sample: true
  max_gen_toks: 256  # GSM8K需要更长的推理过程
filter_list:
  - name: "single"  # 单次回答基线 (samples=1)
    filter:
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "take_first"
  - name: "maj@5"   # 5次多数投票 (samples=5)
    filter:
      - function: "take_first_k"
        k: 5
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@10"  # 10次多数投票 (samples=10)
    filter:
      - function: "take_first_k"
        k: 10
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@20"  # 20次多数投票 (samples=20)
    filter:
      - function: "take_first_k"
        k: 20
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@30"  # 30次多数投票 (samples=30)
    filter:
      - function: "take_first_k"
        k: 30
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@50"  # 50次多数投票 (samples=50)
    filter:
      - function: "take_first_k"
        k: 50
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@100" # 100次多数投票 (samples=100)
    filter:
      - function: "take_first_k"
        k: 100
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@200" # 200次多数投票 (samples=200)
    filter:
      - function: "take_first_k"
        k: 200
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@300" # 300次多数投票 (samples=300)
    filter:
      - function: "take_first_k"
        k: 300
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
  - name: "maj@500" # 500次多数投票 (samples=500) - 使用所有样本
    filter:
      - function: "take_first_k"
        k: 500
      - function: "regex"
        regex_pattern: "#### (\\-?[0-9\\.\\,]+)"
      - function: "majority_vote"
      - function: "take_first"
